#!/usr/bin/env bash

# Worker and miner
WORKER="sheldon"
MINER="/usr/local/bin/miner.d"
GMINER="$MINER/gminer"

# Wallets
NH_WALLET="34douYJySifha8N9yJUwAM8aV59sP8R1Vo.$WORKER"
IRONFISH_WALLET="3bb463f5d4f0a609bce871164513c1b31d8d2533197dc529518ffbd6e17304e1.$WORKER"

# Pools
IRONFISH_POOL="de.ironfish.herominers.com:1145"
NH_ETHASH="stratum+ssl://daggerhashimoto.auto.nicehash.com:443"
NH_KHEAVYHASH="stratum+ssl://kheavyhash.auto.nicehash.com:443"
NH_ZELHASH="stratum+ssl://zelhash.auto.nicehash.com:443"
NH_ZHASH="stratum+ssl://zhash.auto.nicehash.com:443"


# Help/usage panel
usage () {
  echo -e "$0 [--profit] <combo>\n"
  echo "Options:"
  echo -e "\t--profit => Calculates profitability scores and recommends the best algorithm
                    to mine amongst all available ones (also does Nicehash/Pool comparison).\n"
  echo "Mining algorithm combos:"
  echo -e "\tkas+zil  => KASPA + ZILLIQA, both from Nicehash."
  echo -e "\tflux+zil => FLUX + ZILLIQA, both from Nicehash."
  echo -e "\tiron+zil => IRON (HeroMiners Pool) + ZILLIQA (Nicehash)."
}


# Profitability panel
profit () {
  API="https://whattomine.com/coins.json"
  algos="KAS FLUX IRON"

  for algo in $algos; do
    profit_value=$(
      curl -s "$API"                                  \
        | jq ".coins[] | select(.tag == \""$algo"\")" \
        | jq ".profitability"
    )
    echo -e "  \033[1;35m$algo => $profit_value\033[0m"
    unset $profit_value
  done
}


###########################
# === KASPA + ZILLIQA === #
###########################
# KASPA: kHeavyHash -> core intensive ; low power.
# ZILLIQA: Ethash (modified) -> memory intensive ; moderate power.
kas_zil () {
  sudo "$GMINER"              \
    --algo kheavyhash         \
    --server "$NH_KHEAVYHASH" \
    --user "$NH_WALLET"       \
    --lock_cclock 1450        \
    --cclock +100             \
    --mclock -2000            \
    --zilserver "$NH_ETHASH"  \
    --ziluser "$NH_WALLET"    \
    --zillock_cclock 1110     \
    --zilmclock +1900         \
    --share_check 0           \
    --report_interval 90
}

##########################
# === FLUX + ZILLIQA === #
##########################
# FLUX: ZelHash -> core intensive ; high power.
# ZILLIQA: Ethash (modified) -> memory intensive ; moderate power.
flux_zil () {
  sudo "$GMINER"             \
    --algo equihash125_4     \
    --pers "ZelProof"        \
    --server "$NH_ZELHASH"   \
    --user "$NH_WALLET"      \
    --lock_cclock 1440       \
    --cclock +150            \
    --mclock -2000           \
    --zilserver "$NH_ETHASH" \
    --ziluser "$NH_WALLET"   \
    --zillock_cclock 1110    \
    --zilmclock +1900        \
    --share_check 0          \
    --report_interval 90
}

##########################
# === IRON + ZILLIQA === #
##########################
# IRON: IronFish (Blake3-Iron) -> core intensive ; low power.
# ZILLIQA: Ethash (modified) -> memory intensive ; moderate power.
iron_zil () {
  sudo "$GMINER"              \
    --algo ironfish           \
    --server "$IRONFISH_POOL" \
    --user "$IRONFISH_WALLET" \
    --lock_cclock 1470        \
    --cclock +150             \
    --mclock -2000            \
    --zilserver "$NH_ETHASH"  \
    --ziluser "$NH_WALLET"    \
    --zillock_cclock 1110     \
    --zilmclock +1900         \
    --share_check 0           \
    --report_interval 90
}


################
# === MAIN === #
################
case "$1" in
  kas+zil)
    kas_zil
    ;;
  flux+zil)
    flux_zil
    ;;
  iron+zil)
    iron_zil
    ;;
  --profit)
    profit
    ;;
  -h|--help)
    usage
    ;;
  *)
    echo "[-] Incorrect syntax :("
    echo "[*] Open help panel with -h or --help"
    ;;
esac

